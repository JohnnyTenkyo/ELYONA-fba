# FBA库存备货管理系统 - 项目文档

## 一、项目概述

### 1.1 项目目的
本系统旨在为跨境电商亚马逊运营团队和工厂提供一套完整的出货计划和备货计划指导辅助系统，帮助团队：
- 高效管理多品牌SKU数据
- 预测库存需求，避免断货或库存积压
- 规划发货时间，优化物流成本
- 协调工厂备货，确保供应链顺畅
- 应对促销活动和春节等特殊时期的备货需求

### 1.2 目标用户
- 亚马逊运营团队：负责日常库存监控、发货计划制定
- 工厂/供应商：根据备货计划安排生产和发货
- 管理层：通过数据看板了解整体运营状况

### 1.3 技术架构
- **前端**: React 19 + TypeScript + Tailwind CSS 4 + shadcn/ui
- **后端**: Express + tRPC 11
- **数据库**: MySQL (TiDB)
- **认证**: 自定义用户名密码认证 + 品牌数据隔离

---

## 二、核心功能模块

### 2.1 用户认证系统
- **登录/注册**: 用户名密码方式，支持多品牌账户
- **数据隔离**: 每个品牌账户只能看到自己的数据
- **初始账户**: ELYONA/123456（首次使用）

### 2.2 SKU管理
- **字段**: SKU编码、类别（标准件/大件）、日销量、备注、品牌名称、淘汰状态
- **操作**: 批量导入/导出Excel、单独添加/编辑/删除、批量清空
- **淘汰管理**: 已淘汰SKU自动排除出预警和计划

### 2.3 FBA库存同步
- **数据来源**: ERP导出的Excel文件
- **字段映射**:
  - MSKU → SKU
  - FBA可用库存 → 在售库存
  - FBA标发在途 → 在途库存
- **历史记录**: 记录每次同步的成功/失败数量

### 2.4 库存预警系统
- **三级预警机制**:
  - 🔴 **紧急预警**: 7天内缺货且无在途
  - 🟡 **一般预警**: 35天内缺货且无在途
  - 🟢 **库存充足**: 可售卖35天以上
- **建议日销**: 根据库存和运输周期计算建议日销量
- **分类显示**: 标准件和大件分开展示

### 2.5 运输配置
| 配置项 | 标准件默认值 | 大件默认值 |
|--------|-------------|-----------|
| 船期 | 25天 | 35天 |
| 上架天数 | 10天 | 10天 |
| **总周期** | **35天** | **45天** |

### 2.6 货件详情管理
- **货件视图**: 按货运号分组，显示每票货件的SKU明细、总数量、状态
- **SKU视图**: 按SKU分组，显示在途总数，可展开查看具体货件
- **状态标签**:
  - 🔵 运输中: 正常运输
  - 🟢 提前到达: 预计到货日期提前
  - 🔴 延迟到达: 预计到货日期延后
  - ⚫ 已到达: 确认收货
- **查询链接**: 集成凯琦和鹰龙物流查询

### 2.7 促销项目管理
- **项目类型**: 春季Prime Day、黑五网一等
- **历史数据**: 导入去年促销期间各SKU销量
- **计算逻辑**:
  - 促销日销 = 历史销量 / 促销天数
  - 补发数量 = (促销日销 - 日常日销) × 促销天数
- **最晚发货时间**:
  - 标准件: 促销前 35+7=42 天
  - 大件: 促销前 45+7=52 天
- **横道图**: 年度视图，显示各促销项目的备货周期和最晚发货时间

### 2.8 发货计划总表
- **分类**: 标准件和大件分开两个表
- **核心字段**:
  - SKU、日销量、FBA库存、在途数量
  - 缺货预测（天数/日期）
  - 计划发货时间和数量
- **动态发货列**: 可添加多列实际发货日期和数量
- **合计行**: 汇总FBA库存、在途数量、计划发货、实际发货等

### 2.9 春节配置
- **配置项**: 放假时间、最后发货时间、复工时间、最早出货时间
- **倒计时**: 提前60天开始提醒
- **联动**: 自动调整发货计划

### 2.10 工厂备货计划
- **按月统计**: 选择月份查看备货需求
- **核心指标**:
  - 月度需求 = 日销量 × 30
  - 建议备货 = 目标库存 - 当前总库存
- **状态标记**:
  - 🔴 需加单: 实际发货 < 月度需求 × 80%
  - 🟢 过量: 实际发货 > 月度需求 × 120%

---

## 三、核心计算规则

### 3.1 库存预警计算
```
可售天数 = FBA库存 / 日销量

紧急预警: 可售天数 ≤ 7 且 在途库存 = 0
一般预警: 可售天数 ≤ 35 且 在途库存 = 0
库存充足: 可售天数 > 35 或 在途库存 > 0
```

### 3.2 缺货预测计算
```
预计缺货日期 = 今天 + (FBA库存 / 日销量)

考虑在途货件:
1. 按预计到货日期排序所有在途货件
2. 模拟每日库存消耗和补货
3. 找出库存降为0的日期
```

### 3.3 计划发货数量计算
```
目标库存天数 = 60天（2个月周转）
目标库存 = 日销量 × 60
计划发货 = 目标库存 - FBA库存 - 在途库存
```

### 3.4 促销补发数量计算
```
去年促销日销 = 去年促销销量 / 去年促销天数
日销差额 = 去年促销日销 - 日常日销
补发数量 = 日销差额 × 今年促销天数
```

### 3.5 预计到货日期计算
```
预计到货 = 发货日期 + 船期 + 上架天数

标准件: 发货日期 + 25 + 10 = 发货日期 + 35天
大件: 发货日期 + 35 + 10 = 发货日期 + 45天
```

---

## 四、数据库设计

### 4.1 核心表结构

| 表名 | 说明 |
|------|------|
| users | 用户账户 |
| skus | SKU主数据 |
| shipments | 货件主表 |
| shipment_items | 货件明细 |
| promotions | 促销项目 |
| promotion_sales | 促销销量数据 |
| transport_configs | 运输配置 |
| spring_festival_configs | 春节配置 |
| factory_inventory | 工厂库存 |
| actual_shipments | 实际发货记录 |
| fba_sync_history | FBA同步历史 |

### 4.2 关键字段说明

**skus表**:
- `category`: 'standard' | 'oversized' (标准件/大件)
- `dailySales`: 日销量
- `fbaStock`: FBA库存
- `inTransitStock`: 在途库存
- `isDiscontinued`: 是否淘汰

**shipments表**:
- `status`: 'shipping' | 'arrived' | 'early' | 'delayed'
- `expectedArrivalDate`: 预计到货日期
- `actualArrivalDate`: 实际到货日期

---

## 五、使用流程

### 5.1 初始设置
1. 使用初始账户登录或注册新品牌账户
2. 配置运输参数（船期、上架天数）
3. 批量导入SKU数据

### 5.2 日常操作
1. 定期从ERP导出FBA库存Excel并同步
2. 查看库存预警，处理紧急预警SKU
3. 导入货件信息，追踪在途货物
4. 根据发货计划表安排发货

### 5.3 促销备货
1. 创建促销项目，设置时间范围
2. 导入去年促销销量数据
3. 查看补发建议和最晚发货时间
4. 按计划提前备货发货

### 5.4 春节备货
1. 设置春节放假和复工时间
2. 系统自动计算最后发货时间
3. 根据倒计时提醒安排备货

---

## 六、版本历史

### v1.0.0 (2026-01-16)
- 初始版本发布
- 完成全部10个核心功能模块
- 支持多品牌数据隔离
- 实现三级库存预警
- 集成物流查询链接

### v1.1.0 (2026-01-16)
- 货件详情增强：支持修改预计到货日期、状态标签
- SKU视图分类：标准件/大件分开展示
- 发货计划增强：动态实际发货列、在途详情展开、缺货预测详情
- 促销项目重构：横道图、历史数据导入、补发建议
- 导航优化：重新排列顺序，添加"额外配置"分类
- 工厂备货和库存预警：分标准件/大件两页

---

## 七、注意事项

1. **数据备份**: 定期导出重要数据，防止意外丢失
2. **日销量更新**: 建议每周更新日销量数据，保证预测准确性
3. **库存同步**: 建议每日同步FBA库存，及时发现预警
4. **促销准备**: 促销前60天开始关注倒计时提醒
5. **春节备货**: 提前2个月开始规划春节期间的备货

---

*文档最后更新: 2026-01-16*
